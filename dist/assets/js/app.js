!function(){"use strict";function t(){1.6<window.innerHeight/window.innerWidth?(document.body.classList.add("vertical"),document.body.classList.remove("horizontal")):(document.body.classList.add("horizontal"),document.body.classList.remove("vertical"))}var e=class{constructor(){this.questions=[],this.usedIndexes=new Set}async loadQuestions(){if(!this.questions.length)try{var t=await fetch("./assets/js/questions.json");if(!t.ok)throw new Error("Ошибка загрузки questions.json");this.questions=await t.json()}catch(t){console.error("Ошибка при загрузке вопросов:",t)}}async getRandomQuestion(){if(await this.loadQuestions(),this.usedIndexes.size>=this.questions.length)return console.warn("Все вопросы использованы!"),null;let t;for(;t=Math.floor(Math.random()*this.questions.length),this.usedIndexes.has(t););return this.usedIndexes.add(t),this.questions[t]}resetUsedIndexes(){this.usedIndexes.clear()}},s=class{constructor(){this.token="user_token",this.name="User",this.scope=0}saveResult(t){this.scope+=t.points,this.answers.push(t)}getScore(){return this.scope}getName(){return this.name}sendResultToServer(t){console.log("Отправка на сервер",t)}},n=class{constructor(){this.roundEl=document.querySelector("#rounds"),this.roundStatus=this.roundEl.querySelector(".round_status span"),this.roundTarget=this.roundEl.querySelector(".round_target"),this.counterContainer=this.roundEl.querySelector(".round_container"),this.roundInfo=this.roundEl.querySelector(".round_info")}waitForKeyPress(){return new Promise(s=>{document.addEventListener("keydown",function t(e){"Enter"!==e.code&&"Space"!==e.code||(document.removeEventListener("keydown",t),s())})})}waitForClick(){return new Promise(t=>{const e=()=>{document.removeEventListener("keydown",e),document.removeEventListener("mousedown",e),t()};document.addEventListener("keydown",e),document.addEventListener("mousedown",e)})}updateCounter(t){this.counterContainer.innerHTML=t.map((t,e,s)=>`
            <div class="digit-container">
                ${t.alfabet[t.current]}
                <div class="shadow ${e===s.length-1?"green":"grey"}"></div>
            </div>
        `).join("")}showSuccess(t){console.log("Угадал! Очки:",t.points)}showFail(t){console.log("Не попал. Очки:",t.points)}showTooManyFails(){console.log("Три ошибки подряд! Спец. экран.")}showSection(t,e,s=""){""!==s&&(document.querySelector("[data-name]").textContent=s);const n=document.getElementById(t),o=(n.classList.remove("active"),setTimeout(()=>n.classList.add("none"),300),document.getElementById(e));o.classList.remove("none"),setTimeout(()=>o.classList.add("active"),10)}async runBacktimer(){const e=document.querySelector("[data-count]"),t=document.querySelector("[data-text]");for(let t=3;0<t;t--)e.textContent=t,await this.delay(1e3);e.classList.add("hide"),setTimeout(()=>{e.classList.add("slide-up")},300),t.classList.remove("hidden"),setTimeout(()=>{t.classList.add("active")},600),await this.delay(1e3),t.classList.add("disperse"),this.disperseText(t),await this.delay(3e3)}delay(e){return new Promise(t=>setTimeout(t,e))}disperseText(t){t.querySelectorAll("span").forEach((t,e)=>{var s=2*Math.random()*Math.PI,n=40+40*Math.random(),o=Math.cos(s)*n,s=Math.sin(s)*n,n=(60*Math.random()-30).toFixed(1);t.style.setProperty("--x",o+"px"),t.style.setProperty("--y",s+"px"),t.style.setProperty("--r",n+"deg"),t.style.setProperty("--i",e)}),setTimeout(()=>{t.classList.add("animate")},1e3)}showRound(t,n,e){this.roundEl.classList.remove("none"),this.roundStatus.textContent=t,this.roundStatus.closest(".round_status").style.display="block",this.roundTarget.style.display="block",this.roundInfo.style.display="block";t=n.map(t=>t.alfabet[t.target]).join("");this.roundTarget.innerHTML="ПОЙМАЙ "+t,this.roundInfo.innerHTML=e,this.counterContainer.innerHTML="",this.counterContainer.style.display="flex",n.forEach((t,e)=>{var s=document.createElement("div"),t=(s.classList.add("digit-container"),s.textContent=t.alfabet[t.current],document.createElement("div"));t.classList.add("shadow"),t.classList.add(e===n.length-1?"green":"grey"),s.appendChild(t),console.log(s),this.counterContainer.appendChild(s)})}showEnd(){console.log("Игра окончена")}};new class{constructor(){this.round=0,this.maxRounds=3,this.failedAttempts=0,this.maxFails=3,this.started=!1,this.player=new s,this.ui=new n,this.data=new e,this.init()}async init(){await this.ui.waitForKeyPress(),this.ui.showSection("start","hello",this.player.getName()),await this.ui.waitForKeyPress(),this.ui.showSection("hello","backtimer"),await this.ui.runBacktimer(),this.ui.showSection("backtimer","rounds"),this.startGame()}async startGame(){await this.data.loadQuestions(),this.startNextRound()}async startNextRound(){var t=await this.data.getRandomQuestion();t?(this.currentQuestion=structuredClone(t),this.round++,this.ui.showRound(this.round,t.counter,t.fact),this.counterValues=t.counter,this.startCounter(),this.ui.waitForClick().then(()=>{this.stopCounter()})):this.ui.showEnd()}startCounter(){this.started=!0,this.doCycle()}stopCounter(){this.started=!1;var t=this.checkText(),e={points:t?350:50,success:t,round:this.round};this.player.saveResult(e),this.player.sendResultToServer?.(e),t?(this.failedAttempts=0,this.ui.showSuccess(e)):(this.failedAttempts++,this.ui.showFail(e)),this.failedAttempts>=this.maxFails?this.ui.showTooManyFails():setTimeout(()=>this.startNextRound(),2e3)}doCycle(){this.started&&(this.textNext(),this.ui.updateCounter(this.counterValues),setTimeout(()=>this.doCycle(),120))}textNext(){for(let t=this.counterValues.length-1;0<=t;t--){var e=this.counterValues[t];if(e.current++,e.current<e.alfabet.length)break;e.current=0}}checkText(){return this.counterValues.every((t,e)=>t.current===t.target)}},window.addEventListener("load",t),window.addEventListener("resize",t)}();